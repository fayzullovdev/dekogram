{% extends 'base.html' %}
{% load static %}

{% block title %}{{ user_profile.username }} â€¢ Dekogram{% endblock %}

{% block content %}
<main class="main-content" style="max-width: 935px; margin: 40px auto; display: block;">
    <div class="profile-header" style="display: flex; gap: 60px; margin-bottom: 44px; align-items: center;">
        <div class="profile-avatar-container" style="flex: 1; display: flex; justify-content: center;">
            <div class="avatar avatar-xl" style="padding: 4px; border: 2px solid var(--border-color);">
                <img src="{{ user_profile.avatar.url }}" alt="{{ user_profile.username }}">
            </div>
        </div>
        <div class="profile-info-container" style="flex: 2;">
            <div class="profile-top-row" style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
                <h2 style="font-size: 28px; font-weight: 300;">{{ user_profile.username }}</h2>
                {% if user == user_profile %}
                <button class="btn btn-secondary">Edit Profile</button>
                <i class="fas fa-cog pointer" style="font-size: 20px;"></i>
                {% else %}
                <button class="btn btn-primary" id="followBtn"
                    onclick="toggleFollow('{{ user_profile.username }}', this)">
                    {% if is_following %}Following{% else %}Follow{% endif %}
                </button>
                <button class="btn btn-secondary">Message</button>
                {% endif %}
            </div>

            <div class="profile-stats" style="display: flex; gap: 40px; margin-bottom: 24px; font-size: 16px;">
                <span><strong>{{ posts_count }}</strong> posts</span>
                <span><strong>{{ user_profile.followers.count }}</strong> followers</span>
                <span><strong>{{ user_profile.following.count }}</strong> following</span>
            </div>

            <div class="profile-bio">
                <div style="font-weight: 600; margin-bottom: 4px;">{{ user_profile.full_name }}</div>
                <div style="font-size: 15px; line-height: 1.4;">{{ user_profile.bio }}</div>
                {% if user_profile.website %}
                <a href="{{ user_profile.website }}" target="_blank"
                    style="color: var(--primary); font-weight: 600; font-size: 14px; display: block; margin-top: 8px;">
                    <i class="fas fa-link" style="font-size: 12px; margin-right: 4px;"></i> {{ user_profile.website }}
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="profile-tabs">
        <div class="profile-tab active">
            <i class="fas fa-th"></i> Posts
        </div>
        <div class="profile-tab">
            <i class="fas fa-bookmark"></i> Saved
        </div>
        <div class="profile-tab">
            <i class="fas fa-user-tag"></i> Tagged
        </div>
    </div>

    <div class="profile-posts-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 28px;">
        {% for post in posts %}
        <div class="explore-item" onclick="viewPost({{ post.id }})">
            {% if post.media_type == 'video' %}
            <video src="{{ post.media.url }}"></video>
            {% else %}
            <img src="{{ post.media.url }}" alt="Post">
            {% endif %}
            <div class="explore-overlay">
                <div class="explore-stat"><i class="fas fa-heart"></i> {{ post.likes.count }}</div>
                <div class="explore-stat"><i class="fas fa-comment"></i> {{ post.comments.count }}</div>
            </div>
        </div>
        {% empty %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 80px 0; color: var(--text-tertiary);">
            <div style="font-size: 48px; margin-bottom: 20px;"><i class="fas fa-camera"></i></div>
            <h3 style="font-weight: 300; font-size: 24px;">No Posts Yet</h3>
        </div>
        {% endfor %}
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    async function toggleFollow(username, btn) {
        const res = await api.fetch(`/api/users/${username}/follow/`, { method: 'POST' });
        if (res.ok) {
            const data = await res.json();
            btn.textContent = data.status === 'followed' ? 'Following' : 'Follow';
            btn.className = data.status === 'followed' ? 'btn btn-secondary' : 'btn btn-primary';
            setTimeout(() => location.reload(), 500);
        }
    }
</script>
{% endblock %}